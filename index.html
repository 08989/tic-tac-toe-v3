<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #6200ea;
      --primary-light: #9d46ff;
      --secondary: #ff4081;
      --accent: #ffab00;
      --background-light: #f5f7ff;
      --background-dark: #121212;
      --text-light: #333;
      --text-dark: #f0f0f0;
      --board-light: #ffffff;
      --board-dark: #1e1e2f;
      --cell-light: #e0e0ff;
      --cell-dark: #2a2a40;
      --player-x: #ff5252;
      --player-o: #2196f3;
      --win-cell: #4caf50;
      --settings-bg: rgba(255, 255, 255, 0.95);
      --settings-dark: rgba(30, 30, 47, 0.95);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, rgba(30, 60, 114, 0.8), rgba(42, 82, 152, 0.8)), 
                  url('https://images.unsplash.com/photo-1533134486753-c833f0ed4866?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
      background-size: cover;
      background-position: center;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      transition: all 1s ease;
      overflow-x: hidden;
      position: relative;
    }

    body.theme-ocean {
      background: linear-gradient(135deg, rgba(30, 60, 114, 0.8), rgba(42, 82, 152, 0.8)), 
                  url('https://images.unsplash.com/photo-1533134486753-c833f0ed4866?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-sunset {
      background: linear-gradient(135deg, rgba(255, 126, 95, 0.8), rgba(254, 180, 123, 0.8)), 
                  url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-forest {
      background: linear-gradient(135deg, rgba(11, 102, 35, 0.8), rgba(46, 139, 87, 0.8)), 
                  url('https://images.unsplash.com/photo-1448375240586-882707db888b?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-space {
      background: linear-gradient(135deg, rgba(15, 12, 41, 0.8), rgba(48, 43, 99, 0.8)), 
                  url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-desert {
      background: linear-gradient(135deg, rgba(210, 180, 140, 0.8), rgba(205, 133, 63, 0.8)), 
                  url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-candy {
      background: linear-gradient(135deg, rgba(255, 105, 180, 0.8), rgba(173, 216, 230, 0.8)), 
                  url('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-cyber {
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.8), rgba(138, 43, 226, 0.8)), 
                  url('https://images.unsplash.com/photo-1518834107812-67b0b7c58434?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    body.theme-aurora {
      background: linear-gradient(135deg, rgba(0, 255, 127, 0.7), rgba(70, 130, 180, 0.7)), 
                  url('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
    }

    .dark-mode {
      color: var(--text-dark);
    }

    /* Loading screen (faster) */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 6px solid #fff;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .loading-text {
      color: white;
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
      margin-top: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .container {
      max-width: 800px;
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
      position: relative;
      margin-top: 20px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }

    .header h1 {
      font-size: 2.8rem;
      background: linear-gradient(to right, var(--player-x), var(--player-o));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      font-weight: 700;
      letter-spacing: 1px;
      text-align: center;
    }

    .player-display {
      display: flex;
      gap: 25px;
      margin-bottom: 25px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .player {
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      min-width: 180px;
      justify-content: center;
    }

    .player.active {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.08);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
    }

    .player-x {
      color: var(--player-x);
      border: 2px solid var(--player-x);
    }

    .player-o {
      color: var(--player-o);
      border: 2px solid var(--player-o);
    }

    .game-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      background: var(--board-light);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: scale(0.9);
      animation: fadeInScale 0.6s ease forwards;
      animation-delay: 0.2s;
    }

    @keyframes fadeInScale {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .dark-mode .board {
      background: var(--board-dark);
    }

    .board::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent 50%, rgba(255, 255, 255, 0.05) 50%);
      z-index: 0;
    }

    .cell {
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
      cursor: pointer;
      border-radius: 12px;
      background: var(--cell-light);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .dark-mode .cell {
      background: var(--cell-dark);
    }

    .cell:hover {
      transform: translateY(-7px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .cell.x::before, .cell.x::after {
      content: "";
      position: absolute;
      width: 80%;
      height: 12px;
      background: var(--player-x);
      border-radius: 6px;
    }

    .cell.x::before {
      transform: rotate(45deg);
    }

    .cell.x::after {
      transform: rotate(-45deg);
    }

    .cell.o::before {
      content: "";
      position: absolute;
      width: 60%;
      height: 60%;
      border: 12px solid var(--player-o);
      border-radius: 50%;
    }

    .winning-cell {
      animation: pulse 1.5s infinite;
      background: rgba(76, 175, 80, 0.25);
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.5); }
      70% { box-shadow: 0 0 0 20px rgba(76, 175, 80, 0); }
      100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
    }

    .controls {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 10px;
    }

    .btn {
      padding: 14px 30px;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
      color: white;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);
    }

    .btn:active {
      transform: translateY(2px);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--player-x), var(--player-o));
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--player-o), #4caf50);
    }

    /* Settings panel in top right corner */
    .settings-container {
      position: fixed;
      top: 25px;
      right: 25px;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .settings-btn {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
      color: white;
      font-size: 1.7rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border: none;
      margin-bottom: 15px;
    }

    .settings-btn:hover {
      transform: rotate(30deg) scale(1.12);
    }

    .settings-box {
      background: var(--settings-bg);
      padding: 25px;
      border-radius: 18px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      display: none;
      flex-direction: column;
      gap: 18px;
      transition: all 0.3s ease;
      width: 300px;
      z-index: 100;
      max-height: 70vh;
      overflow-y: auto;
    }

    .dark-mode .settings-box {
      background: var(--settings-dark);
    }

    .settings-box h3 {
      margin-bottom: 15px;
      color: var(--text-light);
      text-align: center;
      font-size: 1.5rem;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
    }

    .dark-mode .settings-box h3 {
      color: var(--text-dark);
    }

    .settings-section {
      margin-bottom: 15px;
    }

    .settings-section h4 {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
    }

    .dark-mode .settings-section h4 {
      color: var(--accent);
    }

    .settings-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(0,0,0,0.1);
    }

    .dark-mode .settings-option {
      border-bottom: 1px dashed rgba(255,255,255,0.1);
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .theme-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .theme-btn {
      height: 40px;
      border-radius: 8px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.9rem;
      padding: 0 10px;
    }

    .theme-btn.active {
      border-color: white;
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    .theme-ocean { background: linear-gradient(135deg, #1e3c72, #2a5298); }
    .theme-sunset { background: linear-gradient(135deg, #ff7e5f, #feb47b); }
    .theme-forest { background: linear-gradient(135deg, #0b6623, #2e8b57); }
    .theme-space { background: linear-gradient(135deg, #0f0c29, #302b63); }
    .theme-desert { background: linear-gradient(135deg, #d2b48c, #cd853f); }
    .theme-candy { background: linear-gradient(135deg, #ff69b4, #add8e6); }
    .theme-cyber { background: linear-gradient(135deg, #00ffff, #8a2be2); }
    .theme-aurora { background: linear-gradient(135deg, #00ff7f, #4682b4); }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
    }

    .volume-slider {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      background: #ddd;
      border-radius: 3px;
      outline: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: var(--primary);
      border-radius: 50%;
      cursor: pointer;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(5px);
      padding: 20px;
      border-radius: 18px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      width: 100%;
      flex-wrap: wrap;
      gap: 15px;
    }

    .stat-item {
      text-align: center;
      min-width: 120px;
    }

    .stat-label {
      font-size: 1.1rem;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 2.2rem;
      font-weight: bold;
    }

    .x-wins {
      color: var(--player-x);
    }

    .o-wins {
      color: var(--player-o);
    }

    .draws {
      color: #9c27b0;
    }

    .difficulty-selector {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
      transition: all 0.3s ease;
    }

    .difficulty-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 1rem;
      min-width: 100px;
    }

    .difficulty-btn.active {
      background: linear-gradient(135deg, var(--player-x), var(--player-o));
      transform: scale(1.1);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      display: none;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s ease;
    }

    .modal.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 25px;
      text-align: center;
      max-width: 90%;
      width: 450px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
      transform: translateY(-60px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .dark-mode .modal-content {
      background: var(--board-dark);
      color: white;
    }

    .modal.show .modal-content {
      transform: translateY(0);
    }

    .modal h2 {
      font-size: 2.8rem;
      margin-bottom: 25px;
      background: linear-gradient(to right, var(--player-x), var(--player-o));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .winner-icon {
      font-size: 5rem;
      margin: 25px 0;
      animation: bounce 1s ease infinite alternate;
    }

    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-20px); }
    }

    .winner-x {
      color: var(--player-x);
    }

    .winner-o {
      color: var(--player-o);
    }

    .winner-draw {
      color: #9c27b0;
    }

    /* Music selection styles */
    .music-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .music-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      background: rgba(0,0,0,0.05);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .dark-mode .music-option {
      background: rgba(255,255,255,0.05);
    }

    .music-option:hover {
      background: rgba(0,0,0,0.1);
    }

    .dark-mode .music-option:hover {
      background: rgba(255,255,255,0.1);
    }

    .music-option.active {
      background: rgba(var(--primary-rgb), 0.15);
      border-left: 4px solid var(--primary);
    }

    .music-option i {
      font-size: 1.2rem;
      color: var(--primary);
    }

    .music-title {
      flex: 1;
      font-size: 0.95rem;
    }

    .now-playing {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      padding: 10px;
      background: rgba(0,0,0,0.1);
      border-radius: 50px;
    }

    .dark-mode .now-playing {
      background: rgba(255,255,255,0.1);
    }

    .now-playing i {
      color: var(--primary);
      animation: pulse 2s infinite;
    }

    .now-playing-text {
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Theme preview in settings */
    .theme-preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.1;
      background-size: cover;
      background-position: center;
      pointer-events: none;
    }

    /* Responsive design */
    @media (max-width: 650px) {
      .container {
        padding: 20px;
        margin-top: 100px;
      }
      
      .header h1 {
        font-size: 2.2rem;
      }
      
      .cell {
        width: 80px;
        height: 80px;
        font-size: 3rem;
      }
      
      .player {
        padding: 12px 20px;
        font-size: 1.1rem;
        min-width: 160px;
      }
      
      .btn {
        padding: 12px 20px;
        font-size: 1rem;
      }
      
      .stat-value {
        font-size: 1.8rem;
      }
      
      .settings-container {
        top: 15px;
        right: 15px;
      }
      
      .settings-box {
        width: 260px;
      }
      
      .theme-options {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .cell {
        width: 70px;
        height: 70px;
      }
      
      .player {
        min-width: 140px;
        padding: 10px 15px;
      }
      
      .difficulty-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
        min-width: 80px;
      }
      
      .board {
        padding: 15px;
      }
      
      .settings-container {
        top: 10px;
        right: 10px;
      }
      
      .settings-box {
        width: 240px;
        padding: 20px;
      }
      
      .theme-options {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="theme-ocean">
  <!-- Loading screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading Tic Tac Toe...</div>
  </div>

  <!-- Settings panel -->
  <div class="settings-container">
    <button class="settings-btn" onclick="toggleSettings()">
      <i class="fas fa-cog"></i>
    </button>
    <div id="settingsBox" class="settings-box">
      <h3>Game Settings</h3>
      
      <div class="settings-section">
        <h4><i class="fas fa-volume-up"></i> Audio Settings</h4>
        <div class="settings-option">
          <label for="sound">Sound Effects</label>
          <label class="switch">
            <input type="checkbox" id="sound" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <label for="music">Background Music</label>
          <label class="switch">
            <input type="checkbox" id="music" checked>
            <span class="slider"></span>
          </label>
        </div>
        <div class="volume-control">
          <i class="fas fa-volume-down"></i>
          <input type="range" min="0" max="100" value="70" class="volume-slider" id="volume">
          <i class="fas fa-volume-up"></i>
        </div>
        
        <h4 style="margin-top: 15px;"><i class="fas fa-music"></i> Music Selection</h4>
        <div class="music-options">
          <div class="music-option active" data-track="chill" onclick="changeMusic('chill')">
            <i class="fas fa-headphones"></i>
            <span class="music-title">Chill Vibes</span>
          </div>
          <div class="music-option" data-track="adventure" onclick="changeMusic('adventure')">
            <i class="fas fa-mountain"></i>
            <span class="music-title">Adventure Theme</span>
          </div>
          <div class="music-option" data-track="electronic" onclick="changeMusic('electronic')">
            <i class="fas fa-bolt"></i>
            <span class="music-title">Electronic Beat</span>
          </div>
        </div>
        
        <div class="now-playing">
          <i class="fas fa-play"></i>
          <span class="now-playing-text">Now Playing: Chill Vibes</span>
        </div>
      </div>
      
      <div class="settings-section">
        <h4><i class="fas fa-palette"></i> Theme</h4>
        <div class="theme-options">
          <button class="theme-btn theme-ocean active" onclick="changeTheme('ocean')">Ocean</button>
          <button class="theme-btn theme-sunset" onclick="changeTheme('sunset')">Sunset</button>
          <button class="theme-btn theme-forest" onclick="changeTheme('forest')">Forest</button>
          <button class="theme-btn theme-space" onclick="changeTheme('space')">Space</button>
          <button class="theme-btn theme-desert" onclick="changeTheme('desert')">Desert</button>
          <button class="theme-btn theme-candy" onclick="changeTheme('candy')">Candy</button>
          <button class="theme-btn theme-cyber" onclick="changeTheme('cyber')">Cyber</button>
          <button class="theme-btn theme-aurora" onclick="changeTheme('aurora')">Aurora</button>
        </div>
      </div>
      
      <div class="settings-section">
        <h4><i class="fas fa-gamepad"></i> Game Options</h4>
        <div class="settings-option">
          <label for="haptics">Vibration</label>
          <label class="switch">
            <input type="checkbox" id="haptics">
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <label for="darkModeToggle">Dark Mode</label>
          <label class="switch">
            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <label for="winAnimation">Win Animation</label>
          <label class="switch">
            <input type="checkbox" id="winAnimation" checked>
            <span class="slider"></span>
          </label>
        </div>
      </div>
      
      <div class="settings-section">
        <h4><i class="fas fa-chart-line"></i> Statistics</h4>
        <div class="settings-option">
          <label>Games Played:</label>
          <span id="gamesPlayed">0</span>
        </div>
        <button class="btn btn-primary" onclick="resetStats()" style="margin-top: 10px; width: 100%;">
          <i class="fas fa-trash"></i> Reset Stats
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <h1><i class="fas fa-gamepad"></i> Tic Tac Toe</h1>
    </div>
    
    <div class="game-area">
      <div class="player-display">
        <div class="player player-x active" id="playerX">
          <i class="fas fa-times"></i> Player X
        </div>
        <div class="player player-o" id="playerO">
          <i class="far fa-circle"></i> Player O
        </div>
      </div>
      
      <div class="board" id="board">
        <!-- Board cells will be generated here -->
      </div>
      
      <div class="difficulty-selector" id="difficultySelector">
        <button class="difficulty-btn active" data-level="easy">Easy</button>
        <button class="difficulty-btn" data-level="medium">Medium</button>
        <button class="difficulty-btn" data-level="hard">Hard</button>
      </div>
      
      <div class="controls">
        <button class="btn btn-primary" onclick="resetGame()">
          <i class="fas fa-redo"></i> New Game
        </button>
        <button class="btn btn-secondary" onclick="switchMode()">
          <i class="fas fa-robot"></i> Switch to PvP
        </button>
      </div>
      
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">X Wins</div>
          <div class="stat-value x-wins" id="xWins">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">O Wins</div>
          <div class="stat-value o-wins" id="oWins">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Draws</div>
          <div class="stat-value draws" id="draws">0</div>
        </div>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="confettiCanvas"></canvas>
  
  <div class="modal" id="resultModal">
    <div class="modal-content">
      <h2 id="resultTitle">Victory!</h2>
      <div class="winner-icon" id="winnerIcon"></div>
      <p id="resultMessage">Player X has won the game!</p>
      <button class="btn btn-primary" onclick="resetGame()">
        <i class="fas fa-play"></i> Play Again
      </button>
    </div>
  </div>

  <!-- Sound effects -->
  <audio id="placeSound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" preload="auto"></audio>
  <audio id="drawSound" src="https://www.soundjay.com/misc/sounds/magic-chime-01.mp3" preload="auto"></audio>
  
  <!-- Background music tracks -->
  <audio id="bgm-chill" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
  </audio>
  <audio id="bgm-adventure" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" type="audio/mpeg">
  </audio>
  <audio id="bgm-electronic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" type="audio/mpeg">
  </audio>

  <script>
    // Game state
    let currentPlayer = 'X';
    let board = ['', '', '', '', '', '', '', '', ''];
    let gameActive = true;
    let gameMode = 'pvc'; // Player vs Computer
    let gamesPlayed = 0;
    let xWins = 0;
    let oWins = 0;
    let draws = 0;
    let difficulty = 'easy';
    let currentTheme = 'ocean';
    let currentMusic = 'chill';
    
    // DOM elements
    const boardEl = document.getElementById('board');
    const playerXEl = document.getElementById('playerX');
    const playerOEl = document.getElementById('playerO');
    const gamesPlayedEl = document.getElementById('gamesPlayed');
    const xWinsEl = document.getElementById('xWins');
    const oWinsEl = document.getElementById('oWins');
    const drawsEl = document.getElementById('draws');
    const resultModal = document.getElementById('resultModal');
    const resultTitle = document.getElementById('resultTitle');
    const resultMessage = document.getElementById('resultMessage');
    const winnerIcon = document.getElementById('winnerIcon');
    const placeSound = document.getElementById('placeSound');
    const winSound = document.getElementById('winSound');
    const drawSound = document.getElementById('drawSound');
    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');
    const difficultySelector = document.getElementById('difficultySelector');
    const loadingScreen = document.getElementById('loadingScreen');
    
    // Background music elements
    const backgroundMusic = {
      chill: document.getElementById('bgm-chill'),
      adventure: document.getElementById('bgm-adventure'),
      electronic: document.getElementById('bgm-electronic')
    };
    
    // Initialize the game
    function initGame() {
      // Set canvas size
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
      
      // Create the game board
      renderBoard();
      
      // Add event listeners
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          difficulty = btn.dataset.level;
          saveSettings();
          resetGame();
        });
      });
      
      // Set up volume control
      const volumeSlider = document.getElementById('volume');
      volumeSlider.addEventListener('input', () => {
        Object.values(backgroundMusic).forEach(music => {
          music.volume = volumeSlider.value / 100;
        });
        saveSettings();
      });
      
      // Set up music toggle
      document.getElementById('music').addEventListener('change', function() {
        if (this.checked) {
          backgroundMusic[currentMusic].play().catch(e => console.log("Autoplay prevented: ", e));
        } else {
          Object.values(backgroundMusic).forEach(music => music.pause());
        }
        saveSettings();
      });
      
      // Load settings
      loadSettings();
      
      // Start background music
      if (document.getElementById('music').checked) {
        backgroundMusic[currentMusic].play().catch(e => console.log("Autoplay prevented: ", e));
      }
      
      // Hide loading screen after minimal delay
      setTimeout(() => {
        loadingScreen.classList.add('hidden');
      }, 300);
    }
    
    // Render the game board
    function renderBoard() {
      boardEl.innerHTML = '';
      for (let i = 0; i < 9; i++) {
        const div = document.createElement('div');
        div.className = 'cell';
        if (board[i] === 'X') div.classList.add('x');
        if (board[i] === 'O') div.classList.add('o');
        div.dataset.index = i;
        div.onclick = () => handleMove(i);
        boardEl.appendChild(div);
      }
    }
    
    // Handle player move
    function handleMove(index) {
      if (!gameActive || board[index] !== '') return;
      
      // Play sound
      if (document.getElementById('sound').checked) {
        placeSound.currentTime = 0;
        placeSound.play();
      }
      
      // Vibrate for mobile
      if (document.getElementById('haptics').checked && 'vibrate' in navigator) {
        navigator.vibrate(50);
      }
      
      // Make move
      board[index] = currentPlayer;
      renderBoard();
      
      // Check for win or draw
      if (checkWin(currentPlayer)) {
        endGame(currentPlayer);
        return;
      }
      
      if (isBoardFull()) {
        endGame('draw');
        return;
      }
      
      // Switch player
      switchPlayer();
      
      // If playing against computer and it's computer's turn
      if (gameMode === 'pvc' && currentPlayer === 'O') {
        setTimeout(aiMove, 500);
      }
    }
    
    // AI move logic
    function aiMove() {
      if (!gameActive) return;
      
      let index;
      
      if (difficulty === 'easy') {
        // Easy: random move
        index = getRandomMove();
      } else if (difficulty === 'medium') {
        // Medium: block if player can win, otherwise random
        index = getStrategicMove();
      } else {
        // Hard: use minimax algorithm with alpha-beta pruning
        index = minimax(board, 'O', -Infinity, Infinity).index;
      }
      
      handleMove(index);
    }
    
    // Get random move for AI
    function getRandomMove() {
      const available = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
      return available[Math.floor(Math.random() * available.length)];
    }
    
    // Get strategic move for AI (medium difficulty)
    function getStrategicMove() {
      // Check if AI can win
      for (let i = 0; i < board.length; i++) {
        if (board[i] === '') {
          board[i] = 'O';
          if (checkWin('O')) {
            board[i] = '';
            return i;
          }
          board[i] = '';
        }
      }
      
      // Block player from winning
      for (let i = 0; i < board.length; i++) {
        if (board[i] === '') {
          board[i] = 'X';
          if (checkWin('X')) {
            board[i] = '';
            return i;
          }
          board[i] = '';
        }
      }
      
      // Otherwise random move
      return getRandomMove();
    }
    
    // Minimax algorithm with alpha-beta pruning for hard difficulty
    function minimax(newBoard, player, alpha, beta) {
      const availSpots = newBoard.map((v, i) => v === '' ? i : null).filter(i => i !== null);
      
      // Check terminal states
      if (checkWin('X')) return { score: -10 };
      if (checkWin('O')) return { score: 10 };
      if (availSpots.length === 0) return { score: 0 };
      
      let bestMove;
      
      if (player === 'O') {
        let bestScore = -Infinity;
        for (const spot of availSpots) {
          newBoard[spot] = 'O';
          const result = minimax(newBoard, 'X', alpha, beta);
          newBoard[spot] = '';
          
          if (result.score > bestScore) {
            bestScore = result.score;
            bestMove = { index: spot, score: bestScore };
          }
          
          alpha = Math.max(alpha, bestScore);
          if (beta <= alpha) break;
        }
        return bestMove;
      } else {
        let bestScore = Infinity;
        for (const spot of availSpots) {
          newBoard[spot] = 'X';
          const result = minimax(newBoard, 'O', alpha, beta);
          newBoard[spot] = '';
          
          if (result.score < bestScore) {
            bestScore = result.score;
            bestMove = { index: spot, score: bestScore };
          }
          
          beta = Math.min(beta, bestScore);
          if (beta <= alpha) break;
        }
        return bestMove;
      }
    }
    
    // Switch current player
    function switchPlayer() {
      currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
      updatePlayerDisplay();
    }
    
    // Update player display
    function updatePlayerDisplay() {
      playerXEl.classList.toggle('active', currentPlayer === 'X');
      playerOEl.classList.toggle('active', currentPlayer === 'O');
    }
    
    // Check for win
    function checkWin(player) {
      const winPatterns = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
        [0, 4, 8], [2, 4, 6]             // Diagonals
      ];
      
      for (const pattern of winPatterns) {
        if (pattern.every(index => board[index] === player)) {
          // Highlight winning cells
          pattern.forEach(index => {
            document.querySelector(`.cell[data-index="${index}"]`).classList.add('winning-cell');
          });
          return true;
        }
      }
      return false;
    }
    
    // Check if board is full (draw)
    function isBoardFull() {
      return board.every(cell => cell !== '');
    }
    
    // End the game
    function endGame(result) {
      gameActive = false;
      gamesPlayed++;
      
      // Play sound
      if (document.getElementById('sound').checked) {
        if (result === 'draw') {
          drawSound.play();
        } else {
          winSound.play();
        }
      }
      
      // Vibrate for mobile
      if (document.getElementById('haptics').checked && 'vibrate' in navigator) {
        navigator.vibrate(200);
      }
      
      // Update stats
      if (result === 'X') {
        xWins++;
      } else if (result === 'O') {
        oWins++;
      } else {
        draws++;
      }
      
      // Show result modal
      showResultModal(result);
      
      // Update UI
      updateStats();
      saveSettings();
    }
    
    // Show result modal
    function showResultModal(result) {
      if (result === 'draw') {
        resultTitle.textContent = "It's a Draw!";
        resultMessage.textContent = "No one wins this round!";
        winnerIcon.innerHTML = '<i class="fas fa-handshake"></i>';
        winnerIcon.className = 'winner-icon winner-draw';
      } else {
        resultTitle.textContent = `${result} Wins!`;
        resultMessage.textContent = `Player ${result} has won the game!`;
        winnerIcon.innerHTML = result === 'X' ? '<i class="fas fa-times"></i>' : '<i class="far fa-circle"></i>';
        winnerIcon.className = `winner-icon ${result === 'X' ? 'winner-x' : 'winner-o'}`;
        if (document.getElementById('winAnimation').checked) {
          launchConfetti();
        }
      }
      
      resultModal.classList.add('show');
    }
    
    // Reset the game
    function resetGame() {
      board = ['', '', '', '', '', '', '', '', ''];
      currentPlayer = 'X';
      gameActive = true;
      resultModal.classList.remove('show');
      renderBoard();
      updatePlayerDisplay();
    }
    
    // Switch game mode
    function switchMode() {
      gameMode = gameMode === 'pvc' ? 'pvp' : 'pvc';
      document.querySelector('.btn-secondary').innerHTML = 
        gameMode === 'pvc' ? 
        '<i class="fas fa-robot"></i> Switch to PvP' : 
        '<i class="fas fa-users"></i> Switch to PvC';
      
      // Show/hide difficulty selector based on mode
      if (gameMode === 'pvc') {
        difficultySelector.style.display = 'flex';
      } else {
        difficultySelector.style.display = 'none';
      }
      
      resetGame();
      saveSettings();
    }
    
    // Update statistics display
    function updateStats() {
      gamesPlayedEl.textContent = gamesPlayed;
      xWinsEl.textContent = xWins;
      oWinsEl.textContent = oWins;
      drawsEl.textContent = draws;
    }
    
    // Toggle settings box
    function toggleSettings() {
      const box = document.getElementById('settingsBox');
      box.style.display = box.style.display === 'flex' ? 'none' : 'flex';
    }
    
    // Toggle dark mode
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      saveSettings();
    }
    
    // Change background theme
    function changeTheme(theme) {
      currentTheme = theme;
      document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.theme-${theme}`).classList.add('active');
      
      // Apply the new theme
      document.body.className = `theme-${theme}`;
      if (document.body.classList.contains('dark-mode')) {
        document.body.className += ' dark-mode';
      }
      saveSettings();
    }
    
    // Change background music
    function changeMusic(track) {
      // Pause current music
      Object.values(backgroundMusic).forEach(music => music.pause());
      
      // Update UI
      document.querySelectorAll('.music-option').forEach(option => {
        option.classList.remove('active');
      });
      document.querySelector(`.music-option[data-track="${track}"]`).classList.add('active');
      document.querySelector('.now-playing-text').textContent = `Now Playing: ${document.querySelector(`.music-option[data-track="${track}"] .music-title`).textContent}`;
      
      // Play new music if enabled
      currentMusic = track;
      if (document.getElementById('music').checked) {
        backgroundMusic[track].currentTime = 0;
        backgroundMusic[track].play().catch(e => console.log("Autoplay prevented: ", e));
      }
      
      saveSettings();
    }
    
    // Reset all statistics
    function resetStats() {
      if (confirm("Are you sure you want to reset all game statistics?")) {
        gamesPlayed = 0;
        xWins = 0;
        oWins = 0;
        draws = 0;
        updateStats();
        saveSettings();
      }
    }
    
    // Save settings to localStorage
    function saveSettings() {
      const settings = {
        darkMode: document.body.classList.contains('dark-mode'),
        sound: document.getElementById('sound').checked,
        music: document.getElementById('music').checked,
        haptics: document.getElementById('haptics').checked,
        winAnimation: document.getElementById('winAnimation').checked,
        volume: document.getElementById('volume').value,
        gamesPlayed,
        xWins,
        oWins,
        draws,
        gameMode,
        difficulty,
        currentTheme,
        currentMusic
      };
      localStorage.setItem('ticTacToeSettings', JSON.stringify(settings));
    }
    
    // Load settings from localStorage
    function loadSettings() {
      const savedSettings = localStorage.getItem('ticTacToeSettings');
      if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        
        // Dark mode
        if (settings.darkMode) {
          document.body.classList.add('dark-mode');
          document.getElementById('darkModeToggle').checked = true;
        }
        
        // Sound
        document.getElementById('sound').checked = settings.sound !== false;
        
        // Music
        document.getElementById('music').checked = settings.music !== false;
        
        // Haptics
        document.getElementById('haptics').checked = settings.haptics || false;
        
        // Win animation
        document.getElementById('winAnimation').checked = settings.winAnimation !== false;
        
        // Volume
        document.getElementById('volume').value = settings.volume || 70;
        Object.values(backgroundMusic).forEach(music => {
          music.volume = (settings.volume || 70) / 100;
        });
        
        // Theme
        if (settings.currentTheme) {
          changeTheme(settings.currentTheme);
        }
        
        // Music
        if (settings.currentMusic) {
          changeMusic(settings.currentMusic);
        }
        
        // Stats
        gamesPlayed = settings.gamesPlayed || 0;
        xWins = settings.xWins || 0;
        oWins = settings.oWins || 0;
        draws = settings.draws || 0;
        
        // Game mode
        gameMode = settings.gameMode || 'pvc';
        document.querySelector('.btn-secondary').innerHTML = 
          gameMode === 'pvc' ? 
          '<i class="fas fa-robot"></i> Switch to PvP' : 
          '<i class="fas fa-users"></i> Switch to PvC';
        
        // Show/hide difficulty selector based on mode
        if (gameMode === 'pvc') {
          difficultySelector.style.display = 'flex';
        } else {
          difficultySelector.style.display = 'none';
        }
        
        // Difficulty
        difficulty = settings.difficulty || 'easy';
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
          if (btn.dataset.level === difficulty) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });
        
        updateStats();
      }
    }
    
    // Confetti effect
    function launchConfetti() {
      confettiCanvas.style.display = 'block';
      const confettiCount = 200;
      const gravity = 0.5;
      const colors = ['#ff5252', '#2196f3', '#4caf50', '#ffeb3b', '#9c27b0'];
      
      class Confetti {
        constructor() {
          this.x = Math.random() * confettiCanvas.width;
          this.y = -10;
          this.velocity = Math.random() * 3 + 2;
          this.angle = Math.random() * Math.PI * 2;
          this.spin = Math.random() * 10 - 5;
          this.size = Math.random() * 10 + 5;
          this.color = colors[Math.floor(Math.random() * colors.length)];
        }
        
        update() {
          this.y += this.velocity;
          this.velocity += gravity;
          this.x += Math.sin(this.angle) * 2;
          this.angle += this.spin * 0.01;
        }
        
        draw() {
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate(this.angle);
          ctx.fillStyle = this.color;
          ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
          ctx.restore();
        }
        
        isOffScreen() {
          return this.y > confettiCanvas.height;
        }
      }
      
      const confetti = [];
      
      function animate() {
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        
        // Add new confetti
        if (confetti.length < confettiCount) {
          confetti.push(new Confetti());
        }
        
        // Update and draw confetti
        for (let i = confetti.length - 1; i >= 0; i--) {
          confetti[i].update();
          confetti[i].draw();
          
          // Remove off-screen confetti
          if (confetti[i].isOffScreen()) {
            confetti.splice(i, 1);
          }
        }
        
        if (confetti.length > 0) {
          requestAnimationFrame(animate);
        } else {
          confettiCanvas.style.display = 'none';
        }
      }
      
      animate();
    }
    
    // Initialize the game when window loads
    window.addEventListener('DOMContentLoaded', initGame);
    
    // Handle window resize
    window.addEventListener('resize', () => {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    });
  </script>
</body>
</html>